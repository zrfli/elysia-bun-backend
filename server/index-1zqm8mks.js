// @bun
import{a as u0,f as c0}from"./index-54dcs62y.js";import{ReadableStream as s0}from"stream/web";import{pipeline as W0,PassThrough as r0,Readable as t0}from"stream";import{stat as N0}from"fs/promises";class G extends Error{constructor(){super("End-Of-Stream");this.name="EndOfStreamError"}}class S extends Error{constructor(J="The operation was aborted"){super(J);this.name="AbortError"}}class x1{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((J,Q)=>{this.reject=Q,this.resolve=J})}}class T{constructor(){this.endOfStream=!1,this.interrupted=!1,this.peekQueue=[]}async peek(J,Q=!1){let Y=await this.read(J,Q);return this.peekQueue.push(J.subarray(0,Y)),Y}async read(J,Q=!1){if(J.length===0)return 0;let Y=this.readFromPeekBuffer(J);if(!this.endOfStream)Y+=await this.readRemainderFromStream(J.subarray(Y),Q);if(Y===0)throw new G;return Y}readFromPeekBuffer(J){let Q=J.length,Y=0;while(this.peekQueue.length>0&&Q>0){let K=this.peekQueue.pop();if(!K)throw new Error("peekData should be defined");let X=Math.min(K.length,Q);if(J.set(K.subarray(0,X),Y),Y+=X,Q-=X,X<K.length)this.peekQueue.push(K.subarray(X))}return Y}async readRemainderFromStream(J,Q){let Y=0;while(Y<J.length&&!this.endOfStream){if(this.interrupted)throw new S;let K=await this.readFromStream(J.subarray(Y),Q);if(K===0)break;Y+=K}if(!Q&&Y<J.length)throw new G;return Y}}class a extends T{constructor(J){super();if(this.s=J,this.deferred=null,!J.read||!J.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>{if(this.endOfStream=!0,this.deferred)this.deferred.resolve(0)}),this.s.once("error",(Q)=>this.reject(Q)),this.s.once("close",()=>this.abort())}async readFromStream(J,Q){if(J.length===0)return 0;let Y=this.s.read(J.length);if(Y)return J.set(Y),Y.length;let K={buffer:J,mayBeLess:Q,deferred:new x1};return this.deferred=K.deferred,this.s.once("readable",()=>{this.readDeferred(K)}),K.deferred.promise}readDeferred(J){let Q=this.s.read(J.buffer.length);if(Q)J.buffer.set(Q),J.deferred.resolve(Q.length),this.deferred=null;else this.s.once("readable",()=>{this.readDeferred(J)})}reject(J){if(this.interrupted=!0,this.deferred)this.deferred.reject(J),this.deferred=null}async abort(){this.reject(new S)}async close(){return this.abort()}}class G1 extends T{constructor(J){super();this.reader=J}async abort(){return this.close()}async close(){this.reader.releaseLock()}}class s extends G1{async readFromStream(J,Q){if(J.length===0)return 0;let Y=await this.reader.read(new Uint8Array(J.length),{min:Q?void 0:J.length});if(Y.done)this.endOfStream=Y.done;if(Y.value)return J.set(Y.value),Y.value.length;return 0}}class b extends T{constructor(J){super();this.reader=J,this.buffer=null}writeChunk(J,Q){let Y=Math.min(Q.length,J.length);if(J.set(Q.subarray(0,Y)),Y<Q.length)this.buffer=Q.subarray(Y);else this.buffer=null;return Y}async readFromStream(J,Q){if(J.length===0)return 0;let Y=0;if(this.buffer)Y+=this.writeChunk(J,this.buffer);while(Y<J.length&&!this.endOfStream){let K=await this.reader.read();if(K.done){this.endOfStream=!0;break}if(K.value)Y+=this.writeChunk(J.subarray(Y),K.value)}if(Y===0&&this.endOfStream)throw new G;return Y}abort(){return this.interrupted=!0,this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}}function j1(J){try{let Q=J.getReader({mode:"byob"});if(Q instanceof ReadableStreamDefaultReader)return new b(Q);return new s(Q)}catch(Q){if(Q instanceof TypeError)return new b(J.getReader());throw Q}}class w{constructor(J){if(this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=J?.onClose,J?.abortSignal)J.abortSignal.addEventListener("abort",()=>{this.abort()})}async readToken(J,Q=this.position){let Y=new Uint8Array(J.len);if(await this.readBuffer(Y,{position:Q})<J.len)throw new G;return J.get(Y,0)}async peekToken(J,Q=this.position){let Y=new Uint8Array(J.len);if(await this.peekBuffer(Y,{position:Q})<J.len)throw new G;return J.get(Y,0)}async readNumber(J){if(await this.readBuffer(this.numBuffer,{length:J.len})<J.len)throw new G;return J.get(this.numBuffer,0)}async peekNumber(J){if(await this.peekBuffer(this.numBuffer,{length:J.len})<J.len)throw new G;return J.get(this.numBuffer,0)}async ignore(J){if(this.fileInfo.size!==void 0){let Q=this.fileInfo.size-this.position;if(J>Q)return this.position+=Q,Q}return this.position+=J,J}async close(){await this.abort(),await this.onClose?.()}normalizeOptions(J,Q){if(!this.supportsRandomAccess()&&Q&&Q.position!==void 0&&Q.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return{...{mayBeLess:!1,offset:0,length:J.length,position:this.position},...Q}}abort(){return Promise.resolve()}}var j0=256000;class r extends w{constructor(J,Q){super(Q);this.streamReader=J,this.fileInfo=Q?.fileInfo??{}}async readBuffer(J,Q){let Y=this.normalizeOptions(J,Q),K=Y.position-this.position;if(K>0)return await this.ignore(K),this.readBuffer(J,Q);if(K<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(Y.length===0)return 0;let X=await this.streamReader.read(J.subarray(0,Y.length),Y.mayBeLess);if(this.position+=X,(!Q||!Q.mayBeLess)&&X<Y.length)throw new G;return X}async peekBuffer(J,Q){let Y=this.normalizeOptions(J,Q),K=0;if(Y.position){let X=Y.position-this.position;if(X>0){let $=new Uint8Array(Y.length+X);return K=await this.peekBuffer($,{mayBeLess:Y.mayBeLess}),J.set($.subarray(X)),K-X}if(X<0)throw new Error("Cannot peek from a negative offset in a stream")}if(Y.length>0){try{K=await this.streamReader.peek(J.subarray(0,Y.length),Y.mayBeLess)}catch(X){if(Q?.mayBeLess&&X instanceof G)return 0;throw X}if(!Y.mayBeLess&&K<Y.length)throw new G}return K}async ignore(J){let Q=Math.min(j0,J),Y=new Uint8Array(Q),K=0;while(K<J){let X=J-K,$=await this.readBuffer(Y,{length:Math.min(Q,X)});if($<0)return $;K+=$}return K}abort(){return this.streamReader.abort()}async close(){return this.streamReader.close()}supportsRandomAccess(){return!1}}class Z1 extends w{constructor(J,Q){super(Q);this.uint8Array=J,this.fileInfo={...Q?.fileInfo??{},...{size:J.length}}}async readBuffer(J,Q){if(Q?.position)this.position=Q.position;let Y=await this.peekBuffer(J,Q);return this.position+=Y,Y}async peekBuffer(J,Q){let Y=this.normalizeOptions(J,Q),K=Math.min(this.uint8Array.length-Y.position,Y.length);if(!Y.mayBeLess&&K<Y.length)throw new G;return J.set(this.uint8Array.subarray(Y.position,Y.position+K)),K}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(J){this.position=J}}function k1(J,Q){let Y=new a(J),K=Q??{},X=K.onClose;return K.onClose=async()=>{if(await Y.close(),X)return X()},new r(Y,K)}function t(J,Q){let Y=j1(J),K=Q??{},X=K.onClose;return K.onClose=async()=>{if(await Y.close(),X)return X()},new r(Y,K)}function _1(J,Q){return new Z1(J,Q)}import{open as C0}from"fs/promises";class l extends w{static async fromFile(J){let Q=await C0(J,"r"),Y=await Q.stat();return new l(Q,{fileInfo:{path:J,size:Y.size}})}constructor(J,Q){super(Q);this.fileHandle=J,this.fileInfo=Q.fileInfo}async readBuffer(J,Q){let Y=this.normalizeOptions(J,Q);if(this.position=Y.position,Y.length===0)return 0;let K=await this.fileHandle.read(J,0,Y.length,Y.position);if(this.position+=K.bytesRead,K.bytesRead<Y.length&&(!Q||!Q.mayBeLess))throw new G;return K.bytesRead}async peekBuffer(J,Q){let Y=this.normalizeOptions(J,Q),K=await this.fileHandle.read(J,0,Y.length,Y.position);if(!Y.mayBeLess&&K.bytesRead<Y.length)throw new G;return K.bytesRead}async close(){return await this.fileHandle.close(),super.close()}setPosition(J){this.position=J}supportsRandomAccess(){return!0}}async function h1(J,Q){let Y=k1(J,Q);if(J.path){let K=await N0(J.path);Y.fileInfo.path=J.path,Y.fileInfo.size=K.size}return Y}var m1=l.fromFile;/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function P(J){return new DataView(J.buffer,J.byteOffset)}var p1={len:1,get(J,Q){return P(J).getUint8(Q)},put(J,Q,Y){return P(J).setUint8(Q,Y),Q+1}},j={len:2,get(J,Q){return P(J).getUint16(Q,!0)},put(J,Q,Y){return P(J).setUint16(Q,Y,!0),Q+2}},_={len:2,get(J,Q){return P(J).getUint16(Q)},put(J,Q,Y){return P(J).setUint16(Q,Y),Q+2}};var C={len:4,get(J,Q){return P(J).getUint32(Q,!0)},put(J,Q,Y){return P(J).setUint32(Q,Y,!0),Q+4}},y1={len:4,get(J,Q){return P(J).getUint32(Q)},put(J,Q,Y){return P(J).setUint32(Q,Y),Q+4}};var u1={len:4,get(J,Q){return P(J).getInt32(Q)},put(J,Q,Y){return P(J).setInt32(Q,Y),Q+4}};var c1={len:8,get(J,Q){return P(J).getBigUint64(Q,!0)},put(J,Q,Y){return P(J).setBigUint64(Q,Y,!0),Q+8}};class F{constructor(J,Q){this.len=J,this.encoding=Q,this.textDecoder=new TextDecoder(Q)}get(J,Q){return this.textDecoder.decode(J.subarray(Q,Q+this.len))}}import{createRequire as O0}from"module";var R0=O0("/"),B0;try{B0=R0("worker_threads").Worker}catch(J){}var R=Uint8Array,h=Uint16Array,D0=Int32Array,b1=new R([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l1=new R([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),I0=new R([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d1=function(J,Q){var Y=new h(31);for(var K=0;K<31;++K)Y[K]=Q+=1<<J[K-1];var X=new D0(Y[30]);for(var K=1;K<30;++K)for(var $=Y[K];$<Y[K+1];++$)X[$]=$-Y[K]<<5|K;return{b:Y,r:X}},o1=d1(b1,2),n1=o1.b,U0=o1.r;n1[28]=258,U0[258]=28;var f1=d1(l1,0),E0=f1.b,iJ=f1.r,H1=new h(32768);for(M=0;M<32768;++M)U=(M&43690)>>1|(M&21845)<<1,U=(U&52428)>>2|(U&13107)<<2,U=(U&61680)>>4|(U&3855)<<4,H1[M]=((U&65280)>>8|(U&255)<<8)>>1;var U,M,d=function(J,Q,Y){var K=J.length,X=0,$=new h(Q);for(;X<K;++X)if(J[X])++$[J[X]-1];var V=new h(Q);for(X=1;X<Q;++X)V[X]=V[X-1]+$[X-1]<<1;var q;if(Y){q=new h(1<<Q);var x=15-Q;for(X=0;X<K;++X)if(J[X]){var N=X<<4|J[X],H=Q-J[X],W=V[J[X]-1]++<<H;for(var Z=W|(1<<H)-1;W<=Z;++W)q[H1[W]>>x]=N}}else{q=new h(K);for(X=0;X<K;++X)if(J[X])q[X]=H1[V[J[X]-1]++]>>15-J[X]}return q},o=new R(288);for(M=0;M<144;++M)o[M]=8;var M;for(M=144;M<256;++M)o[M]=9;var M;for(M=256;M<280;++M)o[M]=7;var M;for(M=280;M<288;++M)o[M]=8;var M,i1=new R(32);for(M=0;M<32;++M)i1[M]=5;var M;var L0=d(o,9,1);var A0=d(i1,5,1),C1=function(J){var Q=J[0];for(var Y=1;Y<J.length;++Y)if(J[Y]>Q)Q=J[Y];return Q},D=function(J,Q,Y){var K=Q/8|0;return(J[K]|J[K+1]<<8)>>(Q&7)&Y},N1=function(J,Q){var Y=Q/8|0;return(J[Y]|J[Y+1]<<8|J[Y+2]<<16)>>(Q&7)},w0=function(J){return(J+7)/8|0},g0=function(J,Q,Y){if(Q==null||Q<0)Q=0;if(Y==null||Y>J.length)Y=J.length;return new R(J.subarray(Q,Y))};var S0=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],O=function(J,Q,Y){var K=new Error(Q||S0[J]);if(K.code=J,Error.captureStackTrace)Error.captureStackTrace(K,O);if(!Y)throw K;return K},P1=function(J,Q,Y,K){var X=J.length,$=K?K.length:0;if(!X||Q.f&&!Q.l)return Y||new R(0);var V=!Y,q=V||Q.i!=2,x=Q.i;if(V)Y=new R(X*3);var N=function(T1){var v1=Y.length;if(T1>v1){var z1=new R(Math.max(v1*2,T1));z1.set(Y),Y=z1}},H=Q.f||0,W=Q.p||0,Z=Q.b||0,g=Q.l,f=Q.d,p=Q.m,y=Q.n,Q1=X*8;do{if(!g){H=D(J,W,1);var Y1=D(J,W+1,3);if(W+=3,!Y1){var I=w0(W)+4,K1=J[I-4]|J[I-3]<<8,X1=I+K1;if(X1>X){if(x)O(0);break}if(q)N(Z+K1);Y.set(J.subarray(I,X1),Z),Q.b=Z+=K1,Q.p=W=X1*8,Q.f=H;continue}else if(Y1==1)g=L0,f=A0,p=9,y=5;else if(Y1==2){var $1=D(J,W,31)+257,I1=D(J,W+10,15)+4,U1=$1+D(J,W+5,31)+1;W+=14;var u=new R(U1),W1=new R(19);for(var B=0;B<I1;++B)W1[I0[B]]=D(J,W+B*3,7);W+=I1*3;var E1=C1(W1),M0=(1<<E1)-1,q0=d(W1,E1,1);for(var B=0;B<U1;){var L1=q0[D(J,W,M0)];W+=L1&15;var I=L1>>4;if(I<16)u[B++]=I;else{var z=0,i=0;if(I==16)i=3+D(J,W,3),W+=2,z=u[B-1];else if(I==17)i=3+D(J,W,7),W+=3;else if(I==18)i=11+D(J,W,127),W+=7;while(i--)u[B++]=z}}var A1=u.subarray(0,$1),A=u.subarray($1);p=C1(A1),y=C1(A),g=d(A1,p,1),f=d(A,y,1)}else O(1);if(W>Q1){if(x)O(0);break}}if(q)N(Z+131072);var V0=(1<<p)-1,x0=(1<<y)-1,M1=W;for(;;M1=W){var z=g[N1(J,W)&V0],k=z>>4;if(W+=z&15,W>Q1){if(x)O(0);break}if(!z)O(2);if(k<256)Y[Z++]=k;else if(k==256){M1=W,g=null;break}else{var w1=k-254;if(k>264){var B=k-257,c=b1[B];w1=D(J,W,(1<<c)-1)+n1[B],W+=c}var q1=f[N1(J,W)&x0],V1=q1>>4;if(!q1)O(3);W+=q1&15;var A=E0[V1];if(V1>3){var c=l1[V1];A+=N1(J,W)&(1<<c)-1,W+=c}if(W>Q1){if(x)O(0);break}if(q)N(Z+131072);var g1=Z+w1;if(Z<A){var S1=$-A,G0=Math.min(A,g1);if(S1+Z<0)O(3);for(;Z<G0;++Z)Y[Z]=K[S1+Z]}for(;Z<g1;++Z)Y[Z]=Y[Z-A]}}if(Q.l=g,Q.p=M1,Q.b=Z,Q.f=H,g)H=1,Q.m=p,Q.d=f,Q.n=y}while(!H);return Z!=Y.length&&V?g0(Y,0,Z):Y.subarray(0,Z)};var T0=new R(0);var v0=function(J){if(J[0]!=31||J[1]!=139||J[2]!=8)O(6,"invalid gzip data");var Q=J[3],Y=10;if(Q&4)Y+=(J[10]|J[11]<<8)+2;for(var K=(Q>>3&1)+(Q>>4&1);K>0;K-=!J[Y++]);return Y+(Q&2)},z0=function(J){var Q=J.length;return(J[Q-4]|J[Q-3]<<8|J[Q-2]<<16|J[Q-1]<<24)>>>0};var k0=function(J,Q){if((J[0]&15)!=8||J[0]>>4>7||(J[0]<<8|J[1])%31)O(6,"invalid zlib data");if((J[1]>>5&1)==+!Q)O(6,"invalid zlib data: "+(J[1]&32?"need":"unexpected")+" dictionary");return(J[1]>>3&4)+2};function _0(J,Q){return P1(J,{i:2},Q&&Q.out,Q&&Q.dictionary)}function h0(J,Q){var Y=v0(J);if(Y+8>J.length)O(6,"invalid gzip data");return P1(J.subarray(Y,-8),{i:2},Q&&Q.out||new R(z0(J)),Q&&Q.dictionary)}function m0(J,Q){return P1(J.subarray(k0(J,Q&&Q.dictionary),-4),{i:2},Q&&Q.out,Q&&Q.dictionary)}function a1(J,Q){return J[0]==31&&J[1]==139&&J[2]==8?h0(J,Q):(J[0]&15)!=8||J[0]>>4>7||(J[0]<<8|J[1])%31?_0(J,Q):m0(J,Q)}var p0=typeof TextDecoder!="undefined"&&new TextDecoder,y0=0;try{p0.decode(T0,{stream:!0}),y0=1}catch(J){}var e1=u0(c0(),1);var v={LocalFileHeader:67324752,DataDescriptor:134695760,CentralFileHeader:33639248,EndOfCentralDirectory:101010256},F1={get(J){let Q=j.get(J,6);return{signature:C.get(J,0),compressedSize:C.get(J,8),uncompressedSize:C.get(J,12)}},len:16},s1={get(J){let Q=j.get(J,6);return{signature:C.get(J,0),minVersion:j.get(J,4),dataDescriptor:!!(Q&8),compressedMethod:j.get(J,8),compressedSize:C.get(J,18),uncompressedSize:C.get(J,22),filenameLength:j.get(J,26),extraFieldLength:j.get(J,28),filename:null}},len:30},r1={get(J){return{signature:C.get(J,0),nrOfThisDisk:j.get(J,4),nrOfThisDiskWithTheStart:j.get(J,6),nrOfEntriesOnThisDisk:j.get(J,8),nrOfEntriesOfSize:j.get(J,10),sizeOfCd:C.get(J,12),offsetOfStartOfCd:C.get(J,16),zipFileCommentLength:j.get(J,20)}},len:22},t1={get(J){let Q=j.get(J,8);return{signature:C.get(J,0),minVersion:j.get(J,6),dataDescriptor:!!(Q&8),compressedMethod:j.get(J,10),compressedSize:C.get(J,20),uncompressedSize:C.get(J,24),filenameLength:j.get(J,28),extraFieldLength:j.get(J,30),fileCommentLength:j.get(J,32),relativeOffsetOfLocalHeader:C.get(J,42),filename:null}},len:46};function J0(J){let Q=new Uint8Array(C.len);return C.put(Q,0,J),Q}var E=e1.default("tokenizer:inflate"),O1=262144,b0=J0(v.DataDescriptor),e=J0(v.EndOfCentralDirectory);class R1{constructor(J){this.tokenizer=J,this.syncBuffer=new Uint8Array(O1)}async isZip(){return await this.peekSignature()===v.LocalFileHeader}peekSignature(){return this.tokenizer.peekToken(C)}async findEndOfCentralDirectoryLocator(){let J=this.tokenizer,Q=Math.min(16384,J.fileInfo.size),Y=this.syncBuffer.subarray(0,Q);await this.tokenizer.readBuffer(Y,{position:J.fileInfo.size-Q});for(let K=Y.length-4;K>=0;K--)if(Y[K]===e[0]&&Y[K+1]===e[1]&&Y[K+2]===e[2]&&Y[K+3]===e[3])return J.fileInfo.size-Q+K;return-1}async readCentralDirectory(){if(!this.tokenizer.supportsRandomAccess()){E("Cannot reading central-directory without random-read support");return}E("Reading central-directory...");let J=this.tokenizer.position,Q=await this.findEndOfCentralDirectoryLocator();if(Q>0){E("Central-directory 32-bit signature found");let Y=await this.tokenizer.readToken(r1,Q),K=[];this.tokenizer.setPosition(Y.offsetOfStartOfCd);for(let X=0;X<Y.nrOfEntriesOfSize;++X){let $=await this.tokenizer.readToken(t1);if($.signature!==v.CentralFileHeader)throw new Error("Expected Central-File-Header signature");$.filename=await this.tokenizer.readToken(new F($.filenameLength,"utf-8")),await this.tokenizer.ignore($.extraFieldLength),await this.tokenizer.ignore($.fileCommentLength),K.push($),E(`Add central-directory file-entry: n=${X+1}/${K.length}: filename=${K[X].filename}`)}return this.tokenizer.setPosition(J),K}this.tokenizer.setPosition(J)}async unzip(J){let Q=await this.readCentralDirectory();if(Q)return this.iterateOverCentralDirectory(Q,J);let Y=!1;do{let K=await this.readLocalFileHeader();if(!K)break;let X=J(K);Y=!!X.stop;let $=void 0;if(await this.tokenizer.ignore(K.extraFieldLength),K.dataDescriptor&&K.compressedSize===0){let V=[],q=O1;E("Compressed-file-size unknown, scanning for next data-descriptor-signature....");let x=-1;while(x<0&&q===O1){q=await this.tokenizer.peekBuffer(this.syncBuffer,{mayBeLess:!0}),x=l0(this.syncBuffer.subarray(0,q),b0);let N=x>=0?x:q;if(X.handler){let H=new Uint8Array(N);await this.tokenizer.readBuffer(H),V.push(H)}else await this.tokenizer.ignore(N)}if(E(`Found data-descriptor-signature at pos=${this.tokenizer.position}`),X.handler)await this.inflate(K,d0(V),X.handler)}else if(X.handler)E(`Reading compressed-file-data: ${K.compressedSize} bytes`),$=new Uint8Array(K.compressedSize),await this.tokenizer.readBuffer($),await this.inflate(K,$,X.handler);else E(`Ignoring compressed-file-data: ${K.compressedSize} bytes`),await this.tokenizer.ignore(K.compressedSize);if(E(`Reading data-descriptor at pos=${this.tokenizer.position}`),K.dataDescriptor){if((await this.tokenizer.readToken(F1)).signature!==134695760)throw new Error(`Expected data-descriptor-signature at position ${this.tokenizer.position-F1.len}`)}}while(!Y)}async iterateOverCentralDirectory(J,Q){for(let Y of J){let K=Q(Y);if(K.handler){this.tokenizer.setPosition(Y.relativeOffsetOfLocalHeader);let X=await this.readLocalFileHeader();if(X){await this.tokenizer.ignore(X.extraFieldLength);let $=new Uint8Array(Y.compressedSize);await this.tokenizer.readBuffer($),await this.inflate(X,$,K.handler)}}if(K.stop)break}}inflate(J,Q,Y){if(J.compressedMethod===0)return Y(Q);E(`Decompress filename=${J.filename}, compressed-size=${Q.length}`);let K=a1(Q);return Y(K)}async readLocalFileHeader(){let J=await this.tokenizer.peekToken(C);if(J===v.LocalFileHeader){let Q=await this.tokenizer.readToken(s1);return Q.filename=await this.tokenizer.readToken(new F(Q.filenameLength,"utf-8")),Q}if(J===v.CentralFileHeader)return!1;if(J===3759263696)throw new Error("Encrypted ZIP");throw new Error("Unexpected signature")}}function l0(J,Q){let Y=J.length,K=Q.length;if(K>Y)return-1;for(let X=0;X<=Y-K;X++){let $=!0;for(let V=0;V<K;V++)if(J[X+V]!==Q[V]){$=!1;break}if($)return X}return-1}function d0(J){let Q=J.reduce((X,$)=>X+$.length,0),Y=new Uint8Array(Q),K=0;for(let X of J)Y.set(X,K),K+=X.length;return Y}var YQ={utf8:new globalThis.TextDecoder("utf8")};var KQ=new globalThis.TextEncoder;var XQ=Array.from({length:256},(J,Q)=>Q.toString(16).padStart(2,"0"));function B1(J){let{byteLength:Q}=J;if(Q===6)return J.getUint16(0)*4294967296+J.getUint32(2);if(Q===5)return J.getUint8(0)*4294967296+J.getUint32(1);if(Q===4)return J.getUint32(0);if(Q===3)return J.getUint8(0)*65536+J.getUint16(1);if(Q===2)return J.getUint16(0);if(Q===1)return J.getUint8(0)}function Q0(J){return[...J].map((Q)=>Q.charCodeAt(0))}function Y0(J,Q=0){let Y=Number.parseInt(new F(6).get(J,148).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(Y))return!1;let K=256;for(let X=Q;X<Q+148;X++)K+=J[X];for(let X=Q+156;X<Q+512;X++)K+=J[X];return Y===K}var K0={get:(J,Q)=>J[Q+3]&127|J[Q+2]<<7|J[Q+1]<<14|J[Q]<<21,len:4};var X0=["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ttc","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx","vsdx","vtt","apk","drc","lz4","potx","xltx","dotx","xltm","ott","ots","otp","odg","otg","xlsm","docm","dotm","potm","pptm","jar","rm","ppsm","ppsx"],$0=["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.ms-powerpoint.slideshow.macroenabled.12","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/vnd.apache.arrow.file","video/mp4","audio/midi","video/matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","video/ogg","audio/ogg","audio/ogg; codecs=opus","application/ogg","audio/flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","font/collection","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","text/vtt","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/vnd.apache.parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx","application/vnd.visio","application/vnd.android.package-archive","application/vnd.google.draco","application/x-lz4","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-excel.template.macroenabled.12","application/vnd.oasis.opendocument.text-template","application/vnd.oasis.opendocument.spreadsheet-template","application/vnd.oasis.opendocument.presentation-template","application/vnd.oasis.opendocument.graphics","application/vnd.oasis.opendocument.graphics-template","application/vnd.ms-excel.sheet.macroenabled.12","application/vnd.ms-word.document.macroenabled.12","application/vnd.ms-word.template.macroenabled.12","application/vnd.ms-powerpoint.template.macroenabled.12","application/vnd.ms-powerpoint.presentation.macroenabled.12","application/java-archive","application/vnd.rn-realmedia"];var n=4100;async function o0(J,Q){return new m(Q).fromBuffer(J)}async function n0(J,Q){return new m(Q).fromBlob(J)}function D1(J){switch(J=J.toLowerCase(),J){case"application/epub+zip":return{ext:"epub",mime:J};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:J};case"application/vnd.oasis.opendocument.text-template":return{ext:"ott",mime:J};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:J};case"application/vnd.oasis.opendocument.spreadsheet-template":return{ext:"ots",mime:J};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:J};case"application/vnd.oasis.opendocument.presentation-template":return{ext:"otp",mime:J};case"application/vnd.oasis.opendocument.graphics":return{ext:"odg",mime:J};case"application/vnd.oasis.opendocument.graphics-template":return{ext:"otg",mime:J};case"application/vnd.openxmlformats-officedocument.presentationml.slideshow":return{ext:"ppsx",mime:J};case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return{ext:"xlsx",mime:J};case"application/vnd.ms-excel.sheet.macroenabled":return{ext:"xlsm",mime:"application/vnd.ms-excel.sheet.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.spreadsheetml.template":return{ext:"xltx",mime:J};case"application/vnd.ms-excel.template.macroenabled":return{ext:"xltm",mime:"application/vnd.ms-excel.template.macroenabled.12"};case"application/vnd.ms-powerpoint.slideshow.macroenabled":return{ext:"ppsm",mime:"application/vnd.ms-powerpoint.slideshow.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return{ext:"docx",mime:J};case"application/vnd.ms-word.document.macroenabled":return{ext:"docm",mime:"application/vnd.ms-word.document.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.template":return{ext:"dotx",mime:J};case"application/vnd.ms-word.template.macroenabledtemplate":return{ext:"dotm",mime:"application/vnd.ms-word.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.template":return{ext:"potx",mime:J};case"application/vnd.ms-powerpoint.template.macroenabled":return{ext:"potm",mime:"application/vnd.ms-powerpoint.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.presentation":return{ext:"pptx",mime:J};case"application/vnd.ms-powerpoint.presentation.macroenabled":return{ext:"pptm",mime:"application/vnd.ms-powerpoint.presentation.macroenabled.12"};case"application/vnd.ms-visio.drawing":return{ext:"vsdx",mime:"application/vnd.visio"};case"application/vnd.ms-package.3dmanufacturing-3dmodel+xml":return{ext:"3mf",mime:"model/3mf"};default:}}function L(J,Q,Y){Y={offset:0,...Y};for(let[K,X]of Q.entries())if(Y.mask){if(X!==(Y.mask[K]&J[K+Y.offset]))return!1}else if(X!==J[K+Y.offset])return!1;return!0}async function f0(J,Q){return new m(Q).fromTokenizer(J)}class m{constructor(J){this.options={mpegOffsetTolerance:0,...J},this.detectors=[...J?.customDetectors??[],{id:"core",detect:this.detectConfident},{id:"core.imprecise",detect:this.detectImprecise}],this.tokenizerOptions={abortSignal:J?.signal}}async fromTokenizer(J){let Q=J.position;for(let Y of this.detectors){let K=await Y.detect(J);if(K)return K;if(Q!==J.position)return}}async fromBuffer(J){if(!(J instanceof Uint8Array||J instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof J}\``);let Q=J instanceof Uint8Array?J:new Uint8Array(J);if(!(Q?.length>1))return;return this.fromTokenizer(_1(Q,this.tokenizerOptions))}async fromBlob(J){return this.fromStream(J.stream())}async fromStream(J){let Q=await t(J,this.tokenizerOptions);try{return await this.fromTokenizer(Q)}finally{await Q.close()}}async toDetectionStream(J,Q){let{sampleSize:Y=n}=Q,K,X,$=J.getReader({mode:"byob"});try{let{value:x,done:N}=await $.read(new Uint8Array(Y));if(X=x,!N&&x)try{K=await this.fromBuffer(x.subarray(0,Y))}catch(H){if(!(H instanceof G))throw H;K=void 0}X=x}finally{$.releaseLock()}let V=new TransformStream({async start(x){x.enqueue(X)},transform(x,N){N.enqueue(x)}}),q=J.pipeThrough(V);return q.fileType=K,q}check(J,Q){return L(this.buffer,J,Q)}checkString(J,Q){return this.check(Q0(J),Q)}detectConfident=async(J)=>{if(this.buffer=new Uint8Array(n),J.fileInfo.size===void 0)J.fileInfo.size=Number.MAX_SAFE_INTEGER;if(this.tokenizer=J,await J.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33])){if(await J.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14}))return{ext:"eps",mime:"application/eps"};return{ext:"ps",mime:"application/postscript"}}if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.detectConfident(J);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await J.ignore(6);let Q=await J.readToken(K0);if(J.position+Q>J.fileInfo.size)return{ext:"mp3",mime:"audio/mpeg"};return await J.ignore(Q),this.fromTokenizer(J)}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((this.buffer[0]===67||this.buffer[0]===70)&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255])){if(this.check([247],{offset:3}))return{ext:"jls",mime:"image/jls"};return{ext:"jpg",mime:"image/jpeg"}}if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){let Q;return await new R1(J).unzip((Y)=>{switch(Y.filename){case"META-INF/mozilla.rsa":return Q={ext:"xpi",mime:"application/x-xpinstall"},{stop:!0};case"META-INF/MANIFEST.MF":return Q={ext:"jar",mime:"application/java-archive"},{stop:!0};case"mimetype":return{async handler(K){let X=new TextDecoder("utf-8").decode(K).trim();Q=D1(X)},stop:!0};case"[Content_Types].xml":return{async handler(K){let X=new TextDecoder("utf-8").decode(K),$=X.indexOf('.main+xml"');if($===-1){if(X.includes('ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml"'))Q=D1("application/vnd.ms-package.3dmanufacturing-3dmodel+xml")}else{X=X.slice(0,Math.max(0,$));let V=X.lastIndexOf('"'),q=X.slice(Math.max(0,V+1));Q=D1(q)}},stop:!0};default:if(/classes\d*\.dex/.test(Y.filename))return Q={ext:"apk",mime:"application/vnd.android.package-archive"},{stop:!0};return{}}}),Q??{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await J.ignore(28);let Q=new Uint8Array(8);if(await J.readBuffer(Q),L(Q,[79,112,117,115,72,101,97,100]))return{ext:"opus",mime:"audio/ogg; codecs=opus"};if(L(Q,[128,116,104,101,111,114,97]))return{ext:"ogv",mime:"video/ogg"};if(L(Q,[1,118,105,100,101,111,0]))return{ext:"ogm",mime:"video/ogg"};if(L(Q,[127,70,76,65,67]))return{ext:"oga",mime:"audio/ogg"};if(L(Q,[83,112,101,101,120,32,32]))return{ext:"spx",mime:"audio/ogg"};if(L(Q,[1,118,111,114,98,105,115]))return{ext:"ogg",mime:"audio/ogg"};return{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(this.buffer[2]===3||this.buffer[2]===5||this.buffer[2]===7)&&(this.buffer[3]===4||this.buffer[3]===6||this.buffer[3]===8))return{ext:"zip",mime:"application/zip"};if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF"))return{ext:"pdf",mime:"application/pdf"};if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){let Q=await this.readTiffHeader(!1);if(Q)return Q}if(this.check([77,77])){let Q=await this.readTiffHeader(!0);if(Q)return Q}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function Q(){let V=await J.peekNumber(p1),q=128,x=0;while((V&q)===0&&q!==0)++x,q>>=1;let N=new Uint8Array(x+1);return await J.readBuffer(N),N}async function Y(){let V=await Q(),q=await Q();q[0]^=128>>q.length-1;let x=Math.min(6,q.length),N=new DataView(V.buffer),H=new DataView(q.buffer,q.length-x,x);return{id:B1(N),len:B1(H)}}async function K(V){while(V>0){let q=await Y();if(q.id===17026)return(await J.readToken(new F(q.len))).replaceAll(/\00.*$/g,"");await J.ignore(q.len),--V}}let X=await Y();switch(await K(X.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/matroska"};default:return}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1")||this.checkString("PARE"))return{ext:"parquet",mime:"application/vnd.apache.parquet"};if(this.checkString("ttcf"))return{ext:"ttc",mime:"font/collection"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([4,34,77,24]))return{ext:"lz4",mime:"application/x-lz4"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.checkString(".RMF"))return{ext:"rm",mime:"application/vnd.rn-realmedia"};if(this.checkString("DRACO"))return{ext:"drc",mime:"application/vnd.google.draco"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(this.buffer[6]===0||this.buffer[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){let Q=new F(4,"latin1").get(this.buffer,2);if(Q.match("^d*")&&Q>=1000&&Q<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>")){if(await J.ignore(8),await J.readToken(new F(13,"ascii"))==="debian-binary")return{ext:"deb",mime:"application/x-deb"};return{ext:"ar",mime:"application/x-unix-archive"}}if(this.checkString("WEBVTT")&&[`
`,"\r","\t"," ","\x00"].some((Q)=>this.checkString(Q,{offset:6})))return{ext:"vtt",mime:"text/vtt"};if(this.check([137,80,78,71,13,10,26,10])){await J.ignore(8);async function Q(){return{length:await J.readToken(u1),type:await J.readToken(new F(4,"latin1"))}}do{let Y=await Q();if(Y.length<0)return;switch(Y.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await J.ignore(Y.length+4)}}while(J.position+8<J.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/vnd.apache.arrow.file"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.checkString("ftyp",{offset:4})&&(this.buffer[8]&96)!==0){let Q=new F(4,"latin1").get(this.buffer,8).replace("\x00"," ").trim();switch(Q){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:if(Q.startsWith("3g")){if(Q.startsWith("3g2"))return{ext:"3g2",mime:"video/3gpp2"};return{ext:"3gp",mime:"video/3gpp"}}return{ext:"mp4",mime:"video/mp4"}}}if(this.check([82,73,70,70])){if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function Q(){let Y=new Uint8Array(16);return await J.readBuffer(Y),{id:Y,size:Number(await J.readToken(c1))}}await J.ignore(30);while(J.position+24<J.fileInfo.size){let Y=await Q(),K=Y.size-24;if(L(Y.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){let X=new Uint8Array(16);if(K-=await J.readBuffer(X),L(X,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(L(X,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await J.ignore(K)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await J.ignore(20),await J.readToken(new F(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255])){if(this.check([0,60,0,63,0,120,0,109,0,108],{offset:2}))return{ext:"xml",mime:"application/xml"};return}if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await J.peekBuffer(this.buffer,{length:Math.min(256,J.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("**ACE",{offset:7})&&this.checkString("**",{offset:12}))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){let Q=new DataView(this.buffer.buffer).getUint32(12,!0);if(Q>12&&this.buffer.length>=Q+16)try{let Y=new TextDecoder().decode(this.buffer.subarray(16,Q+16));if(JSON.parse(Y).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.checkString("Kaydara FBX Binary  \x00"))return{ext:"fbx",mime:"application/x.autodesk.fbx"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await J.peekBuffer(this.buffer,{length:Math.min(512,J.fileInfo.size),mayBeLess:!0}),this.checkString("ustar",{offset:257})&&(this.checkString("\x00",{offset:262})||this.checkString(" ",{offset:262}))||this.check([0,0,0,0,0,0],{offset:257})&&Y0(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254])){if(this.check([60,0,63,0,120,0,109,0,108,0],{offset:2}))return{ext:"xml",mime:"application/xml"};if(this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2}))return{ext:"skp",mime:"application/vnd.sketchup.skp"};return}if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"}};detectImprecise=async(J)=>{if(this.buffer=new Uint8Array(n),await J.peekBuffer(this.buffer,{length:Math.min(8,J.fileInfo.size),mayBeLess:!0}),this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(await J.peekBuffer(this.buffer,{length:Math.min(2+this.options.mpegOffsetTolerance,J.fileInfo.size),mayBeLess:!0}),this.buffer.length>=2+this.options.mpegOffsetTolerance)for(let Q=0;Q<=this.options.mpegOffsetTolerance;++Q){let Y=this.scanMpeg(Q);if(Y)return Y}};async readTiffTag(J){let Q=await this.tokenizer.readToken(J?_:j);switch(this.tokenizer.ignore(10),Q){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"};default:}}async readTiffIFD(J){let Q=await this.tokenizer.readToken(J?_:j);for(let Y=0;Y<Q;++Y){let K=await this.readTiffTag(J);if(K)return K}}async readTiffHeader(J){let Q=(J?_:j).get(this.buffer,2),Y=(J?y1:C).get(this.buffer,4);if(Q===42){if(Y>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(Y>=8){let X=(J?_:j).get(this.buffer,8),$=(J?_:j).get(this.buffer,10);if(X===28&&$===254||X===31&&$===11)return{ext:"nef",mime:"image/x-nikon-nef"}}}return await this.tokenizer.ignore(Y),await this.readTiffIFD(J)??{ext:"tif",mime:"image/tiff"}}if(Q===43)return{ext:"tif",mime:"image/tiff"}}scanMpeg(J){if(this.check([255,224],{offset:J,mask:[255,224]})){if(this.check([16],{offset:J+1,mask:[22]})){if(this.check([8],{offset:J+1,mask:[8]}))return{ext:"aac",mime:"audio/aac"};return{ext:"aac",mime:"audio/aac"}}if(this.check([2],{offset:J+1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:J+1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:J+1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}}var i0=new Set(X0),a0=new Set($0);class J1 extends m{async fromStream(J){let Q=await(J instanceof s0?t(J,this.tokenizerOptions):h1(J,this.tokenizerOptions));try{return await super.fromTokenizer(Q)}finally{await Q.close()}}async fromFile(J){let Q=await m1(J);try{return await super.fromTokenizer(Q)}finally{await Q.close()}}async toDetectionStream(J,Q={}){if(!(J instanceof t0))return super.toDetectionStream(J,Q);let{sampleSize:Y=n}=Q;return new Promise((K,X)=>{J.on("error",X),J.once("readable",()=>{(async()=>{try{let $=new r0,V=W0?W0(J,$,()=>{}):J.pipe($),q=J.read(Y)??J.read()??new Uint8Array(0);try{$.fileType=await this.fromBuffer(q)}catch(x){if(x instanceof G)$.fileType=void 0;else X(x)}K(V)}catch($){X($)}})()})})}}async function PQ(J,Q){return new J1(Q).fromFile(J,Q)}async function FQ(J,Q){return new J1(Q).fromStream(J)}async function OQ(J,Q={}){return new J1(Q).toDetectionStream(J,Q)}export{a0 as supportedMimeTypes,i0 as supportedExtensions,OQ as fileTypeStream,f0 as fileTypeFromTokenizer,FQ as fileTypeFromStream,PQ as fileTypeFromFile,o0 as fileTypeFromBuffer,n0 as fileTypeFromBlob,J1 as FileTypeParser};
